<!DOCTYPE html>

<html lang="en" xml:lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link rel="icon" type="image/gif" href="images/favicon.png" />
    <link rel="stylesheet" href="css/style.css" type="text/css" />
    <link rel="stylesheet" href="css/widget.css" type="text/css" />
    <title>RapidContext :: Server &amp; Plug-In Development</title>
  </head>
  <body class="doc">

<div style="position: relative;">
  <img src="images/logotype.png" alt="RapidContext Logotype" style="width: 128px; height: 128px;" />
  <div style="position: absolute; top: 6px; left: 170px; font-family: Trebuchet MS;">
    <a href="http://www.rapidcontext.com/" target="_blank">
      <span style="font-size: 50px; color: #345;">RapidContext</span><br/>
      <span style="font-size: 24px; color: #88AACC;">Access &gt; Discovery &gt; Insight</span><br/>
      <span style="font-size: 18px; color: #666; letter-spacing: 6px; line-height: 24px;">www.rapidcontext.com</span><br/>
    </a>
  </div>
</div>

<table class="navigation widgetNavigationBar" style="margin: 20px 0;">
  <tr>
    <td class="prev"><a href="index.html">Documentation</a></td>
    <td class='prev-active'>&nbsp;</td>
    <td class='active'>Server &amp; Plug-In Development</td>
    <td class='active-end'>&nbsp;</td>
  </tr>
</table>

<!--START-->

<h1>5. Server &amp; Plug-In Development</h1>

<h2 id="plugin_struct">5.1. Plug-in Structure</h2>

<p>All RapidContext server functionality is provided by plug-ins. The plug-ins
are distributed as ZIP files named
<var>[plugin identifier]-[version].plugin</var>, and can contain Java
libraries, procedures, apps, connections, roles or any other object from the
RapidContext storage.  A few plug-ins are reserved with a special meaning:</p>

<ul class="box yellow">
  <li><var>system</var> &mdash; A plug-in that provides all the platform
      built-in functionality. In essence, a platform update consists of
      replacing this plug-in with a new version. This plug-in is always
      searched last, meaning that any file in it may be shadowed by a file
      with the same name from another plug-in.</li>
  <li><var>local</var> &mdash; A plug-in that provides all local modifications
      and additions to RapidContext storage. In particular this plug-in usually
      stores the <var>config.properties</var> file that lists which plug-ins
      to load on startup. This plug-in is always searched first, meaning that
      any file in it will always shadow a file with the same name in another
      plug-in.</li>
</ul>

<p>All installed plug-ins are stored in the <var>plugin</var> directory on the
RapidContext server. Most plug-in are stored in their original ZIP files, which
can contain an internal directory structure like this:</p>

<ul class="box yellow">
  <table style="width: 100%;">
    <tr>
      <td><var>app/</var></td>
      <td>App configuration files</td>
    </tr>
    <tr>
      <td><var>connection/</var></td>
      <td>Connection configuration files</td>
    </tr>
    <tr>
      <td><var>environment/</var></td>
      <td>Environment configuration files</td>
    </tr>
    <tr>
      <td><var>files/</var></td>
      <td>Contains files to serve via HTTP (maps directly to URL:s)</td>
    </tr>
    <tr>
      <td><var>lib/</var></td>
      <td>Java JAR libraries to load (server-side)</td>
    </tr>
    <tr>
      <td><var>procedure/</var></td>
      <td>Procedure configuration files</td>
    </tr>
    <tr>
      <td><var>role/</var></td>
      <td>Role configuration files</td>
    </tr>
    <tr>
      <td><var>user/</var></td>
      <td>User configuration files</td>
    </tr>
    <tr>
      <td><var>plugin.properties</var></td>
      <td>The plug-in configuration file (mandatory, see below)</td>
    </tr>
  </table>
</ul>

<p>The directories are names according to the type of objects contained. The
exceptions being <var>files</var> and <var>lib</var> that are handled in a
special way. The <var>files</var> contains all the JavaScript code and images
to make available to web browsers.</p>


<h2 id="plugin_config">5.2. Plug-in Configuration</h2>

<p>Each plug-in must contain a <var>plugin.properties</var> configuration file.
It is the only mandatory content of a plug-in and consists of the following
fields:</p>

<ul class="box yellow">
  <li><var>id</var> &mdash; The unique plug-in identifier. May only contain
      ASCII alphanumeric characters without spaces or separators.</li>
  <li><var>name</var> &mdash; The plug-in name as presented to the users.</li>
  <li><var>version</var> &mdash; The plug-in version number. This number is
      automatically modified if the Ant script in <var>plugin-build.xml</var>
      is used for packaging the plug-in.</li>
  <li><var>date</var> &mdash; The plug-in build date. This number is
      automatically set if the Ant script in <var>plugin-build.xml</var> is
      used for packaging the plug-in.</li>
  <li><var>description</var> &mdash; The optional description text that
      explains the functionality in provided by the plug-in.</li>
  <li><var>copyright</var> &mdash; The optional copyright statement text.</li>
  <li><var>className</var> &mdash; The optional fully qualified name of
      a Java class that handles the plug-in life-cycle. The class must be a
      subclass of <var>org.rapidcontext.app.plugin.Plugin</var>.</li>
</ul>

<p>The plug-in configuration is the first file to write when developing a
plug-in. An example <var>plugin.properties</var> file is shown below:</p>

<pre class="box blue code">
<span class="comment"># General properties</span>
id = example
name = Example Plug-in
version = 1.0
date =
description = Provides tests and examples for the platform.
className = org.rapidcontext.app.plugin.example.ExamplePlugin
</pre>

<p>Once the <var>plugin.properties</var> file has been created, the Ant script
in <var>plugin-build.xml</var> can be used for packaging the plug-in.</p>


<h2 id="procedures">5.3. Procedures &amp; Procedure Types</h2>

<p>Server-side operations can be added by creating <strong>procedures</strong>.
Procedures can be invoked from the client or from other procedures and may take
arguments, modify data and/or return values.</p>

<p>Each procedure has a specific type (or kind). The procedure type defines
which Java code is used to execute the procedure, similar to a templating
engine. Since most server-side operations very similar, only a few different
procedure types are needed. The standard procedure types are listed below, but
more can be added by installing additional plug-ins.</p>

<ul class="box yellow">
  <li><var>built-in</var> &mdash; The built-in procedure type, used for one-off
      procedures implemented directly in Java code. This type is normally only
      used for platform operations.</li>
  <li><var>cmdline.exec</var> &mdash; The command-line execution procedure
      type, used for running shell commands on the server. Procedure arguments
      can used as arguments on the command-line.</li>
  <li><var>http.post</var> &mdash; The HTTP POST request procedure type, used
      for sending data to a receiving URL. Procedure arguments can be inserted
      into either the request headers and/or data payload.</li>
  <li><var>javascript</var> &mdash; The JavaScript procedure type, used for
      building a procedure in JavaScript (usually to provide business logic and
      smarts to more basic procedures). Procedure arguments are available as
      global variables during execution.</li>
  <li><var>jdbc.query</var> &mdash; The JDBC query procedure type, used for
      SQL SELECT queries returning results. Procedure arguments may be inserted
      as literals into the SQL text.</li>
  <li><var>jdbc.statement</var> &mdash; The JDBC statement procedure type, used
      for SQL INSERT, UPDATE and DELETE statements (among others). Procedure
      arguments may be inserted as literals into the SQL text.</li>
</ul>


<h2 id="procedure_editing">5.4. Procedure Editing</h2>

<p>Using the <strong>Admin</strong> app, it is easy to create or edit
procedures of any type (except <var>built-in</var>). The screenshot below
shows the location of the <q>+</q> icon for adding a new procedure. Just next
to it is the edit icon.</p>

<p style="text-align: center;">
  <img src="images/screenshot-procedure-buttons.png" />
</p>

<p>After clicking the add or edit icon, the following dialog is shown:</p>

<p style="text-align: center;">
  <img src="images/screenshot-procedure-edit.png" />
</p>

<p>Procedures created or edited are stored to the <var>procedure/</var>
directory inside the <var>local</var> plug-in. The files there can be copied to
the corresponding plug-in development development for packaging.</p>


<h2 id="procedures">5.6. Procedure Authoring</h2>

<div class="box red">
  <img src="images/stop.png" class="left" alt="Warning" />
  <h2 style="margin: 0;">Section In Progress</h2>
  This section is not yet complete. Any information below is temporary.
</div>

<p>By storing SQL queries, JavaScript code or similar as configuration
parameters, it is possible to create advanced procedures easily without
writing any Java code at all. Each procedure configuration parameter has
a specific type, as listed below:</p>

<ol class="box yellow">
  <li><strong>Constant Data</strong> &mdash; The value is a data string that
      may or may not span multiple lines.</li>
  <li><strong>Procedure Reference</strong> &mdash; The value contains a
      procedure name. The procedure can be called by using the identifier
      as a function (JavaScript only).</li>
  <li><strong>Connection Reference</strong> &mdash; The value contains a
      connection name. The connection will be reserved before calling the
      procedure and the identifier allows calling any connection methods
      directly from JavaScript.</li>
  <li><strong>Procedure Argument</strong> &mdash; The value is the
      description of a procedure argument, as shown to the user. When the
      procedure is executing, the identifier will be replaced by the value
      provided by the procedure caller.</li>
</ol>


<!--END-->

<div class="fineprint">
  <hr>
  Copyright &copy; 2007-2012 Per Cederberg. All rights reserved.
</div>

  </body>

</html>
