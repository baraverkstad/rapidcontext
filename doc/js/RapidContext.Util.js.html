
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="JsDoc" />
    <link rel="stylesheet" href="../css/style.css" type="text/css">
    <link rel="stylesheet" href="../css/doc.css" type="text/css">
    <link rel="stylesheet" href="../css/font-awesome-4.7.0.min.css" type="text/css">
    <link rel="shortcut icon" type="image/vnd.microsoft.icon" href="../images/logotype-icon.ico">
    <link rel="icon" type="image/png" sizes="256x256" href="../images/logotype-icon-256x256.png">
    <link rel="apple-touch-icon" sizes="256x256" href="../images/logotype-icon-256x256.png">
    <title>RapidContext :: JavaScript API</title>
  </head>
  <body class="doc">

    <section class="header">
      <div class="center">
        <a href="https://www.rapidcontext.com/" class="logotype">
          <img src="../images/logotype.png" />
        </a>
        <div class="text">
          <a href="https://www.rapidcontext.com/">
            <span style="font-size: 3.6em;">RapidContext</span><br>
            <span style="font-size: 1.75em; color: #caf3ff;">Access &#183; Discovery &#183; Insight</span><br>
            <span style="font-size: 1.3em; letter-spacing: 0.34em; line-height: 1.8em;">www.rapidcontext.com</span>
          </a>
        </div>
      </div>
      <div class="menu">
        <a href="https://www.rapidcontext.com/doc/index.html">Docs</a>
        &bull; <a href="https://github.com/cederberg/rapidcontext/releases">Downloads</a>
        &bull; <a href="https://github.com/cederberg/rapidcontext">Project</a>
      </div>
    </section>

    <section class="content center">
      <ol class="breadcrumb">
        <li><a href="../index.html">Documentation</a></li>

        <li><a href="index.html">JavaScript API</a></li>
        <li class="active">RapidContext.Util.js</li>

      </ol>

      <div class="jsdoc">
        <h1 class="classTitle">Source RapidContext.Util.js</h1>




    <section>
        <article>
            <pre><code class="hljs language-js"><span id="line1" class="lineno">1</span><span class="hljs-comment">/*
<span id="line2" class="lineno">2</span> * RapidContext &lt;https://www.rapidcontext.com/&gt;
<span id="line3" class="lineno">3</span> * Copyright (c) 2007-2023 Per Cederberg. All rights reserved.
<span id="line4" class="lineno">4</span> *
<span id="line5" class="lineno">5</span> * This program is free software: you can redistribute it and/or
<span id="line6" class="lineno">6</span> * modify it under the terms of the BSD license.
<span id="line7" class="lineno">7</span> *
<span id="line8" class="lineno">8</span> * This program is distributed in the hope that it will be useful,
<span id="line9" class="lineno">9</span> * but WITHOUT ANY WARRANTY; without even the implied warranty of
<span id="line10" class="lineno">10</span> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
<span id="line11" class="lineno">11</span> *
<span id="line12" class="lineno">12</span> * See the RapidContext LICENSE for more details.
<span id="line13" class="lineno">13</span> */</span>
<span id="line14" class="lineno">14</span>
<span id="line15" class="lineno">15</span><span class="hljs-comment">// Create default RapidContext object</span>
<span id="line16" class="lineno">16</span><span class="hljs-keyword">if</span> (<span class="hljs-title function_">typeof</span>(<span class="hljs-title class_">RapidContext</span>) == <span class="hljs-string">&quot;undefined&quot;</span>) {
<span id="line17" class="lineno">17</span>    <span class="hljs-title class_">RapidContext</span> = {};
<span id="line18" class="lineno">18</span>}
<span id="line19" class="lineno">19</span>
<span id="line20" class="lineno">20</span><span class="hljs-comment">/**
<span id="line21" class="lineno">21</span> * Provides utility functions for basic objects, arrays, DOM nodes and CSS.
<span id="line22" class="lineno">22</span> * These functions are complementary to what is available in MochiKit and/or
<span id="line23" class="lineno">23</span> * jQuery.
<span id="line24" class="lineno">24</span> * <span class="hljs-doctag">@namespace</span> RapidContext.Util
<span id="line25" class="lineno">25</span> */</span>
<span id="line26" class="lineno">26</span><span class="hljs-keyword">if</span> (<span class="hljs-title function_">typeof</span>(<span class="hljs-title class_">RapidContext</span>.<span class="hljs-property">Util</span>) == <span class="hljs-string">&quot;undefined&quot;</span>) {
<span id="line27" class="lineno">27</span>    <span class="hljs-title class_">RapidContext</span>.<span class="hljs-property">Util</span> = {};
<span id="line28" class="lineno">28</span>}
<span id="line29" class="lineno">29</span>
<span id="line30" class="lineno">30</span>
<span id="line31" class="lineno">31</span><span class="hljs-comment">// General utility functions</span>
<span id="line32" class="lineno">32</span>
<span id="line33" class="lineno">33</span><span class="hljs-comment">/**
<span id="line34" class="lineno">34</span> * Creates a dictionary object from a list of keys and values. Optionally a
<span id="line35" class="lineno">35</span> * list of key-value pairs can be provided instead. As a third option, a single
<span id="line36" class="lineno">36</span> * (non-array) value can be assigned to all the keys.
<span id="line37" class="lineno">37</span> *
<span id="line38" class="lineno">38</span> * If a key is specified twice, only the last value will be used. Note that
<span id="line39" class="lineno">39</span> * this function is the reverse of `MochiKit.Base.items()`,
<span id="line40" class="lineno">40</span> * `MochiKit.Base.keys()` and `MochiKit.Base.values()`.
<span id="line41" class="lineno">41</span> *
<span id="line42" class="lineno">42</span> * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Array</span>} itemsOrKeys the list of keys or items
<span id="line43" class="lineno">43</span> * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Array</span>} [values] the list of values (optional if key-value
<span id="line44" class="lineno">44</span> *            pairs are specified in first argument)
<span id="line45" class="lineno">45</span> *
<span id="line46" class="lineno">46</span> * <span class="hljs-doctag">@return</span> {<span class="hljs-type">Object</span>} an object with properties for each key-value pair
<span id="line47" class="lineno">47</span> *
<span id="line48" class="lineno">48</span> * <span class="hljs-doctag">@deprecated</span> Use RapidContext.Data.object() instead.
<span id="line49" class="lineno">49</span> *
<span id="line50" class="lineno">50</span> * <span class="hljs-doctag">@example</span>
<span id="line51" class="lineno">51</span> * RapidContext.Util.dict([&#x27;a&#x27;,&#x27;b&#x27;], [1, 2])
<span id="line52" class="lineno">52</span> * ==&gt; { a: 1, b: 2 }
<span id="line53" class="lineno">53</span> *
<span id="line54" class="lineno">54</span> * <span class="hljs-doctag">@example</span>
<span id="line55" class="lineno">55</span> * RapidContext.Util.dict([[&#x27;a&#x27;, 1], [&#x27;b&#x27;, 2]])
<span id="line56" class="lineno">56</span> * ==&gt; { a: 1, b: 2 }
<span id="line57" class="lineno">57</span> *
<span id="line58" class="lineno">58</span> * <span class="hljs-doctag">@example</span>
<span id="line59" class="lineno">59</span> * RapidContext.Util.dict([&#x27;a&#x27;,&#x27;b&#x27;], true)
<span id="line60" class="lineno">60</span> * ==&gt; { a: true, b: true }
<span id="line61" class="lineno">61</span> */</span>
<span id="line62" class="lineno">62</span><span class="hljs-title class_">RapidContext</span>.<span class="hljs-property">Util</span>.<span class="hljs-property">dict</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">itemsOrKeys, values</span>) {
<span id="line63" class="lineno">63</span>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">&quot;deprecated: RapidContext.Util.dict() called, use RapidContext.Data.object() instead&quot;</span>);
<span id="line64" class="lineno">64</span>    <span class="hljs-keyword">var</span> o = {};
<span id="line65" class="lineno">65</span>    <span class="hljs-keyword">if</span> (!<span class="hljs-title class_">MochiKit</span>.<span class="hljs-property">Base</span>.<span class="hljs-title function_">isArrayLike</span>(itemsOrKeys)) {
<span id="line66" class="lineno">66</span>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeError</span>(<span class="hljs-string">&quot;First argument must be array-like&quot;</span>);
<span id="line67" class="lineno">67</span>    }
<span id="line68" class="lineno">68</span>    <span class="hljs-keyword">if</span> (<span class="hljs-title class_">MochiKit</span>.<span class="hljs-property">Base</span>.<span class="hljs-title function_">isArrayLike</span>(values) &amp;&amp; itemsOrKeys.<span class="hljs-property">length</span> !== values.<span class="hljs-property">length</span>) {
<span id="line69" class="lineno">69</span>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeError</span>(<span class="hljs-string">&quot;Both arrays must be of same length&quot;</span>);
<span id="line70" class="lineno">70</span>    }
<span id="line71" class="lineno">71</span>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; itemsOrKeys.<span class="hljs-property">length</span>; i++) {
<span id="line72" class="lineno">72</span>        <span class="hljs-keyword">var</span> k = itemsOrKeys[i];
<span id="line73" class="lineno">73</span>        <span class="hljs-keyword">if</span> (k === <span class="hljs-literal">null</span> || k === <span class="hljs-literal">undefined</span>) {
<span id="line74" class="lineno">74</span>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeError</span>(<span class="hljs-string">&quot;Key at index &quot;</span> + i + <span class="hljs-string">&quot; is null or undefined&quot;</span>);
<span id="line75" class="lineno">75</span>        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-title class_">MochiKit</span>.<span class="hljs-property">Base</span>.<span class="hljs-title function_">isArrayLike</span>(k)) {
<span id="line76" class="lineno">76</span>            o[k[<span class="hljs-number">0</span>]] = k[<span class="hljs-number">1</span>];
<span id="line77" class="lineno">77</span>        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-title class_">MochiKit</span>.<span class="hljs-property">Base</span>.<span class="hljs-title function_">isArrayLike</span>(values)) {
<span id="line78" class="lineno">78</span>            o[k] = values[i];
<span id="line79" class="lineno">79</span>        } <span class="hljs-keyword">else</span> {
<span id="line80" class="lineno">80</span>            o[k] = values;
<span id="line81" class="lineno">81</span>        }
<span id="line82" class="lineno">82</span>    }
<span id="line83" class="lineno">83</span>    <span class="hljs-keyword">return</span> o;
<span id="line84" class="lineno">84</span>};
<span id="line85" class="lineno">85</span>
<span id="line86" class="lineno">86</span><span class="hljs-comment">/**
<span id="line87" class="lineno">87</span> * Filters an object by removing a list of keys. A list of key names (or an
<span id="line88" class="lineno">88</span> * object whose property names will be used as keys) must be specified as an
<span id="line89" class="lineno">89</span> * argument. A new object containing the source object values for the specified
<span id="line90" class="lineno">90</span> * keys will be returned. The source object will be modified by removing all
<span id="line91" class="lineno">91</span> * the specified keys.
<span id="line92" class="lineno">92</span> *
<span id="line93" class="lineno">93</span> * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Object</span>} src the source object to select and modify
<span id="line94" class="lineno">94</span> * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Array|Object</span>} keys the list of keys to remove, or an
<span id="line95" class="lineno">95</span> *            object with the keys to remove
<span id="line96" class="lineno">96</span> *
<span id="line97" class="lineno">97</span> * <span class="hljs-doctag">@return</span> {<span class="hljs-type">Object</span>} a new object containing the matching keys and
<span id="line98" class="lineno">98</span> *             values found in the source object
<span id="line99" class="lineno">99</span> *
<span id="line100" class="lineno">100</span> * <span class="hljs-doctag">@deprecated</span> This function will be removed in the future.
<span id="line101" class="lineno">101</span> *
<span id="line102" class="lineno">102</span> * <span class="hljs-doctag">@example</span>
<span id="line103" class="lineno">103</span> * var o = { a: 1, b: 2 };
<span id="line104" class="lineno">104</span> * RapidContext.Util.mask(o, [&#x27;a&#x27;, &#x27;c&#x27;]);
<span id="line105" class="lineno">105</span> * ==&gt; { a: 1 } and modifies o to { b: 2 }
<span id="line106" class="lineno">106</span> *
<span id="line107" class="lineno">107</span> * <span class="hljs-doctag">@example</span>
<span id="line108" class="lineno">108</span> * var o = { a: 1, b: 2 };
<span id="line109" class="lineno">109</span> * RapidContext.Util.mask(o, { a: null, c: null });
<span id="line110" class="lineno">110</span> * ==&gt; { a: 1 } and modifies o to { b: 2 }
<span id="line111" class="lineno">111</span> */</span>
<span id="line112" class="lineno">112</span><span class="hljs-title class_">RapidContext</span>.<span class="hljs-property">Util</span>.<span class="hljs-property">mask</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">src, keys</span>) {
<span id="line113" class="lineno">113</span>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">&quot;deprecated: RapidContext.Util.mask() called, use object destructuring assignment instead&quot;</span>);
<span id="line114" class="lineno">114</span>    <span class="hljs-keyword">var</span> res = {};
<span id="line115" class="lineno">115</span>    <span class="hljs-keyword">if</span> (!<span class="hljs-title class_">MochiKit</span>.<span class="hljs-property">Base</span>.<span class="hljs-title function_">isArrayLike</span>(keys)) {
<span id="line116" class="lineno">116</span>        keys = <span class="hljs-title class_">MochiKit</span>.<span class="hljs-property">Base</span>.<span class="hljs-title function_">keys</span>(keys);
<span id="line117" class="lineno">117</span>    }
<span id="line118" class="lineno">118</span>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; keys.<span class="hljs-property">length</span>; i++) {
<span id="line119" class="lineno">119</span>        <span class="hljs-keyword">var</span> k = keys[i];
<span id="line120" class="lineno">120</span>        <span class="hljs-keyword">if</span> (k <span class="hljs-keyword">in</span> src) {
<span id="line121" class="lineno">121</span>            res[k] = src[k];
<span id="line122" class="lineno">122</span>            <span class="hljs-keyword">delete</span> src[k];
<span id="line123" class="lineno">123</span>        }
<span id="line124" class="lineno">124</span>    }
<span id="line125" class="lineno">125</span>    <span class="hljs-keyword">return</span> res;
<span id="line126" class="lineno">126</span>};
<span id="line127" class="lineno">127</span>
<span id="line128" class="lineno">128</span><span class="hljs-comment">/**
<span id="line129" class="lineno">129</span> * Converts a string to a title-cased string. All word boundaries are replaced
<span id="line130" class="lineno">130</span> * with a single space and the subsequent character is capitalized.
<span id="line131" class="lineno">131</span> *
<span id="line132" class="lineno">132</span> * All underscore (&quot;_&quot;), hyphen (&quot;-&quot;) and lower-upper character pairs are
<span id="line133" class="lineno">133</span> * recognized as word boundaries. Note that this function does not change the
<span id="line134" class="lineno">134</span> * capitalization of other characters in the string.
<span id="line135" class="lineno">135</span> *
<span id="line136" class="lineno">136</span> * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} str the string to convert
<span id="line137" class="lineno">137</span> *
<span id="line138" class="lineno">138</span> * <span class="hljs-doctag">@return</span> {<span class="hljs-type">string</span>} the converted string
<span id="line139" class="lineno">139</span> *
<span id="line140" class="lineno">140</span> * <span class="hljs-doctag">@example</span>
<span id="line141" class="lineno">141</span> * RapidContext.Util.toTitleCase(&quot;a short heading&quot;)
<span id="line142" class="lineno">142</span> * ==&gt; &quot;A Short Heading&quot;
<span id="line143" class="lineno">143</span> *
<span id="line144" class="lineno">144</span> * <span class="hljs-doctag">@example</span>
<span id="line145" class="lineno">145</span> * RapidContext.Util.toTitleCase(&quot;camelCase&quot;)
<span id="line146" class="lineno">146</span> * ==&gt; &quot;Camel Case&quot;
<span id="line147" class="lineno">147</span> *
<span id="line148" class="lineno">148</span> * <span class="hljs-doctag">@example</span>
<span id="line149" class="lineno">149</span> * RapidContext.Util.toTitleCase(&quot;bounding-box&quot;)
<span id="line150" class="lineno">150</span> * ==&gt; &quot;Bounding Box&quot;
<span id="line151" class="lineno">151</span> *
<span id="line152" class="lineno">152</span> * <span class="hljs-doctag">@example</span>
<span id="line153" class="lineno">153</span> * RapidContext.Util.toTitleCase(&quot;UPPER_CASE_VALUE&quot;)
<span id="line154" class="lineno">154</span> * ==&gt; &quot;UPPER CASE VALUE&quot;
<span id="line155" class="lineno">155</span> */</span>
<span id="line156" class="lineno">156</span><span class="hljs-title class_">RapidContext</span>.<span class="hljs-property">Util</span>.<span class="hljs-property">toTitleCase</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">str</span>) {
<span id="line157" class="lineno">157</span>    str = str.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/[._-]+/g</span>, <span class="hljs-string">&quot; &quot;</span>).<span class="hljs-title function_">trim</span>();
<span id="line158" class="lineno">158</span>    str = str.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/[a-z][A-Z]/g</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">match</span>) {
<span id="line159" class="lineno">159</span>        <span class="hljs-keyword">return</span> match.<span class="hljs-title function_">charAt</span>(<span class="hljs-number">0</span>) + <span class="hljs-string">&quot; &quot;</span> + match.<span class="hljs-title function_">charAt</span>(<span class="hljs-number">1</span>);
<span id="line160" class="lineno">160</span>    });
<span id="line161" class="lineno">161</span>    str = str.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/(^|\s)[a-z]/g</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">match</span>) {
<span id="line162" class="lineno">162</span>        <span class="hljs-keyword">return</span> match.<span class="hljs-title function_">toUpperCase</span>();
<span id="line163" class="lineno">163</span>    });
<span id="line164" class="lineno">164</span>    <span class="hljs-keyword">return</span> str;
<span id="line165" class="lineno">165</span>};
<span id="line166" class="lineno">166</span>
<span id="line167" class="lineno">167</span><span class="hljs-comment">/**
<span id="line168" class="lineno">168</span> * Resolves a relative URI to an absolute URI. This function will return
<span id="line169" class="lineno">169</span> * absolute URI:s directly and traverse any &quot;../&quot; directory paths in the
<span id="line170" class="lineno">170</span> * specified URI. The base URI provided must be absolute.
<span id="line171" class="lineno">171</span> *
<span id="line172" class="lineno">172</span> * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} uri the relative URI to resolve
<span id="line173" class="lineno">173</span> * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} [base] the absolute base URI, defaults to the
<span id="line174" class="lineno">174</span> *            the current document base URI
<span id="line175" class="lineno">175</span> *
<span id="line176" class="lineno">176</span> * <span class="hljs-doctag">@return</span> {<span class="hljs-type">string</span>} the resolved absolute URI
<span id="line177" class="lineno">177</span> *
<span id="line178" class="lineno">178</span> * <span class="hljs-doctag">@deprecated</span> This function will be removed and/or renamed in the future.
<span id="line179" class="lineno">179</span> *     Use `new URL(..., document.baseURI)` instead.
<span id="line180" class="lineno">180</span> */</span>
<span id="line181" class="lineno">181</span><span class="hljs-title class_">RapidContext</span>.<span class="hljs-property">Util</span>.<span class="hljs-property">resolveURI</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">uri, base</span>) {
<span id="line182" class="lineno">182</span>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">&quot;deprecated: resolveURI() called, use &#x27;new URL(...)&#x27; instead&quot;</span>);
<span id="line183" class="lineno">183</span>    <span class="hljs-keyword">var</span> pos;
<span id="line184" class="lineno">184</span>    base = base || <span class="hljs-variable language_">document</span>.<span class="hljs-property">baseURI</span> || <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementsByTagName</span>(<span class="hljs-string">&quot;base&quot;</span>)[<span class="hljs-number">0</span>].<span class="hljs-property">href</span>;
<span id="line185" class="lineno">185</span>    <span class="hljs-keyword">if</span> (uri.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&quot;:&quot;</span>)) {
<span id="line186" class="lineno">186</span>        <span class="hljs-keyword">return</span> uri;
<span id="line187" class="lineno">187</span>    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (uri.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">&quot;#&quot;</span>)) {
<span id="line188" class="lineno">188</span>        pos = base.<span class="hljs-title function_">lastIndexOf</span>(<span class="hljs-string">&quot;#&quot;</span>);
<span id="line189" class="lineno">189</span>        <span class="hljs-keyword">if</span> (pos &gt;= <span class="hljs-number">0</span>) {
<span id="line190" class="lineno">190</span>            base = base.<span class="hljs-title function_">substring</span>(<span class="hljs-number">0</span>, pos);
<span id="line191" class="lineno">191</span>        }
<span id="line192" class="lineno">192</span>        <span class="hljs-keyword">return</span> base + uri;
<span id="line193" class="lineno">193</span>    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (uri.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">&quot;/&quot;</span>)) {
<span id="line194" class="lineno">194</span>        pos = base.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">&quot;/&quot;</span>, base.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">&quot;://&quot;</span>) + <span class="hljs-number">3</span>);
<span id="line195" class="lineno">195</span>        base = base.<span class="hljs-title function_">substring</span>(<span class="hljs-number">0</span>, pos);
<span id="line196" class="lineno">196</span>        <span class="hljs-keyword">return</span> base + uri;
<span id="line197" class="lineno">197</span>    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (uri.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">&quot;../&quot;</span>)) {
<span id="line198" class="lineno">198</span>        pos = base.<span class="hljs-title function_">lastIndexOf</span>(<span class="hljs-string">&quot;/&quot;</span>);
<span id="line199" class="lineno">199</span>        base = base.<span class="hljs-title function_">substring</span>(<span class="hljs-number">0</span>, pos);
<span id="line200" class="lineno">200</span>        uri = uri.<span class="hljs-title function_">substring</span>(<span class="hljs-number">3</span>);
<span id="line201" class="lineno">201</span>        <span class="hljs-keyword">return</span> <span class="hljs-title class_">RapidContext</span>.<span class="hljs-property">Util</span>.<span class="hljs-title function_">resolveURI</span>(uri, base);
<span id="line202" class="lineno">202</span>    } <span class="hljs-keyword">else</span> {
<span id="line203" class="lineno">203</span>        pos = base.<span class="hljs-title function_">lastIndexOf</span>(<span class="hljs-string">&quot;/&quot;</span>);
<span id="line204" class="lineno">204</span>        base = base.<span class="hljs-title function_">substring</span>(<span class="hljs-number">0</span>, pos + <span class="hljs-number">1</span>);
<span id="line205" class="lineno">205</span>        <span class="hljs-keyword">return</span> base + uri;
<span id="line206" class="lineno">206</span>    }
<span id="line207" class="lineno">207</span>};
<span id="line208" class="lineno">208</span>
<span id="line209" class="lineno">209</span>
<span id="line210" class="lineno">210</span><span class="hljs-comment">// DOM utility functions</span>
<span id="line211" class="lineno">211</span>
<span id="line212" class="lineno">212</span><span class="hljs-comment">/**
<span id="line213" class="lineno">213</span> * Blurs (unfocuses) a specified DOM node and all relevant child nodes. This
<span id="line214" class="lineno">214</span> * function will recursively blur all `&lt;a&gt;`, `&lt;button&gt;`, `&lt;input&gt;`,
<span id="line215" class="lineno">215</span> * `&lt;textarea&gt;` and `&lt;select&gt;` child nodes found.
<span id="line216" class="lineno">216</span> *
<span id="line217" class="lineno">217</span> * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Object</span>} node the HTML DOM node
<span id="line218" class="lineno">218</span> */</span>
<span id="line219" class="lineno">219</span><span class="hljs-title class_">RapidContext</span>.<span class="hljs-property">Util</span>.<span class="hljs-property">blurAll</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">node</span>) {
<span id="line220" class="lineno">220</span>    node.<span class="hljs-title function_">blur</span>();
<span id="line221" class="lineno">221</span>    <span class="hljs-keyword">var</span> tags = [<span class="hljs-string">&quot;A&quot;</span>, <span class="hljs-string">&quot;BUTTON&quot;</span>, <span class="hljs-string">&quot;INPUT&quot;</span>, <span class="hljs-string">&quot;TEXTAREA&quot;</span>, <span class="hljs-string">&quot;SELECT&quot;</span>];
<span id="line222" class="lineno">222</span>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; tags.<span class="hljs-property">length</span>; i++) {
<span id="line223" class="lineno">223</span>        <span class="hljs-keyword">var</span> nodes = node.<span class="hljs-title function_">getElementsByTagName</span>(tags[i]);
<span id="line224" class="lineno">224</span>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> j = <span class="hljs-number">0</span>; j &lt; nodes.<span class="hljs-property">length</span>; j++) {
<span id="line225" class="lineno">225</span>            nodes[j].<span class="hljs-title function_">blur</span>();
<span id="line226" class="lineno">226</span>        }
<span id="line227" class="lineno">227</span>    }
<span id="line228" class="lineno">228</span>};
<span id="line229" class="lineno">229</span>
<span id="line230" class="lineno">230</span><span class="hljs-comment">/**
<span id="line231" class="lineno">231</span> * Registers size constraints for the element width and/or height. The
<span id="line232" class="lineno">232</span> * constraints may either be fixed numeric values or simple arithmetic (in a
<span id="line233" class="lineno">233</span> * string). The formulas will be converted to CSS calc() expressions.
<span id="line234" class="lineno">234</span> *
<span id="line235" class="lineno">235</span> * Legacy constraint functions are still supported and must take two arguments
<span id="line236" class="lineno">236</span> * (parent width and height) and should return a number. The returned number is
<span id="line237" class="lineno">237</span> * set as the new element width or height (in pixels). Any returned value will
<span id="line238" class="lineno">238</span> * also be bounded by the parent element size to avoid calculation errors.
<span id="line239" class="lineno">239</span> *
<span id="line240" class="lineno">240</span> * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Object</span>} node the HTML DOM node
<span id="line241" class="lineno">241</span> * <span class="hljs-doctag">@param</span> {<span class="hljs-type">number|string|function</span>} [width] the width constraint
<span id="line242" class="lineno">242</span> * <span class="hljs-doctag">@param</span> {<span class="hljs-type">number|string|function</span>} [height] the height constraint
<span id="line243" class="lineno">243</span> *
<span id="line244" class="lineno">244</span> * <span class="hljs-doctag">@see</span> RapidContext.Util.resizeElements
<span id="line245" class="lineno">245</span> *
<span id="line246" class="lineno">246</span> * <span class="hljs-doctag">@example</span>
<span id="line247" class="lineno">247</span> * RapidContext.Util.registerSizeConstraints(node, &quot;50%-20&quot;, &quot;100%&quot;);
<span id="line248" class="lineno">248</span> * ==&gt; Sets width to 50%-20 px and height to 100% of parent dimension
<span id="line249" class="lineno">249</span> *
<span id="line250" class="lineno">250</span> * <span class="hljs-doctag">@example</span>
<span id="line251" class="lineno">251</span> * RapidContext.Util.resizeElements(node, otherNode);
<span id="line252" class="lineno">252</span> * ==&gt; Evaluates the size constraints for both nodes
<span id="line253" class="lineno">253</span> */</span>
<span id="line254" class="lineno">254</span><span class="hljs-title class_">RapidContext</span>.<span class="hljs-property">Util</span>.<span class="hljs-property">registerSizeConstraints</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">node, width, height</span>) {
<span id="line255" class="lineno">255</span>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">toCSS</span>(<span class="hljs-params">val</span>) {
<span id="line256" class="lineno">256</span>        <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/[+-]/</span>.<span class="hljs-title function_">test</span>(val)) {
<span id="line257" class="lineno">257</span>            val = <span class="hljs-string">&quot;calc( &quot;</span> + val.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/[+-]/g</span>, <span class="hljs-string">&quot; $&amp; &quot;</span>) + <span class="hljs-string">&quot; )&quot;</span>;
<span id="line258" class="lineno">258</span>        }
<span id="line259" class="lineno">259</span>        val = val.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/(\d)( |$)/g</span>, <span class="hljs-string">&quot;$1px$2&quot;</span>);
<span id="line260" class="lineno">260</span>        <span class="hljs-keyword">return</span> val;
<span id="line261" class="lineno">261</span>    }
<span id="line262" class="lineno">262</span>    node = <span class="hljs-title class_">MochiKit</span>.<span class="hljs-property">DOM</span>.<span class="hljs-title function_">getElement</span>(node);
<span id="line263" class="lineno">263</span>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">typeof</span>(width) == <span class="hljs-string">&quot;number&quot;</span> || <span class="hljs-title function_">typeof</span>(width) == <span class="hljs-string">&quot;string&quot;</span>) {
<span id="line264" class="lineno">264</span>        node.<span class="hljs-property">style</span>.<span class="hljs-property">width</span> = <span class="hljs-title function_">toCSS</span>(<span class="hljs-title class_">String</span>(width));
<span id="line265" class="lineno">265</span>    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-title function_">typeof</span>(width) == <span class="hljs-string">&quot;function&quot;</span>) {
<span id="line266" class="lineno">266</span>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">&quot;registerSizeConstraints: width function support will be removed&quot;</span>, node);
<span id="line267" class="lineno">267</span>        node.<span class="hljs-property">sizeConstraints</span> = node.<span class="hljs-property">sizeConstraints</span> || { <span class="hljs-attr">w</span>: <span class="hljs-literal">null</span>, <span class="hljs-attr">h</span>: <span class="hljs-literal">null</span> };
<span id="line268" class="lineno">268</span>        node.<span class="hljs-property">sizeConstraints</span>.<span class="hljs-property">w</span> = width;
<span id="line269" class="lineno">269</span>    }
<span id="line270" class="lineno">270</span>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">typeof</span>(height) == <span class="hljs-string">&quot;number&quot;</span> || <span class="hljs-title function_">typeof</span>(height) == <span class="hljs-string">&quot;string&quot;</span>) {
<span id="line271" class="lineno">271</span>        node.<span class="hljs-property">style</span>.<span class="hljs-property">height</span> = <span class="hljs-title function_">toCSS</span>(<span class="hljs-title class_">String</span>(height));
<span id="line272" class="lineno">272</span>    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-title function_">typeof</span>(height) == <span class="hljs-string">&quot;function&quot;</span>) {
<span id="line273" class="lineno">273</span>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">&quot;registerSizeConstraints: height function support will be removed&quot;</span>, node);
<span id="line274" class="lineno">274</span>        node.<span class="hljs-property">sizeConstraints</span> = node.<span class="hljs-property">sizeConstraints</span> || { <span class="hljs-attr">w</span>: <span class="hljs-literal">null</span>, <span class="hljs-attr">h</span>: <span class="hljs-literal">null</span> };
<span id="line275" class="lineno">275</span>        node.<span class="hljs-property">sizeConstraints</span>.<span class="hljs-property">h</span> = height;
<span id="line276" class="lineno">276</span>    }
<span id="line277" class="lineno">277</span>};
<span id="line278" class="lineno">278</span>
<span id="line279" class="lineno">279</span><span class="hljs-comment">/**
<span id="line280" class="lineno">280</span> * Resizes one or more DOM nodes using their registered size constraints and
<span id="line281" class="lineno">281</span> * their parent element sizes. The resize operation will only modify those
<span id="line282" class="lineno">282</span> * elements that have constraints, but will perform a depth-first recursion
<span id="line283" class="lineno">283</span> * over all element child nodes as well.
<span id="line284" class="lineno">284</span> *
<span id="line285" class="lineno">285</span> * Partial constraints are accepted, in which case only the width or the height
<span id="line286" class="lineno">286</span> * is modified. Aspect ratio constraints are applied after the width and height
<span id="line287" class="lineno">287</span> * constraints. The result will always be bounded by the parent element width
<span id="line288" class="lineno">288</span> * or height.
<span id="line289" class="lineno">289</span> *
<span id="line290" class="lineno">290</span> * The recursive descent of this function can be limited by adding a
<span id="line291" class="lineno">291</span> * `resizeContent` function to a DOM node. Such a function will be called to
<span id="line292" class="lineno">292</span> * handle all subnode resizing, making it possible to limit or omitting the
<span id="line293" class="lineno">293</span> * DOM tree traversal.
<span id="line294" class="lineno">294</span> *
<span id="line295" class="lineno">295</span> * <span class="hljs-doctag">@param</span> {<span class="hljs-type">...Node</span>} node the HTML DOM nodes to resize
<span id="line296" class="lineno">296</span> *
<span id="line297" class="lineno">297</span> * <span class="hljs-doctag">@see</span> RapidContext.Util.registerSizeConstraints
<span id="line298" class="lineno">298</span> *
<span id="line299" class="lineno">299</span> * <span class="hljs-doctag">@example</span>
<span id="line300" class="lineno">300</span> * RapidContext.Util.resizeElements(node);
<span id="line301" class="lineno">301</span> * ==&gt; Evaluates the size constraints for a node and all child nodes
<span id="line302" class="lineno">302</span> *
<span id="line303" class="lineno">303</span> * <span class="hljs-doctag">@example</span>
<span id="line304" class="lineno">304</span> * elem.resizeContent = () =&gt; {};
<span id="line305" class="lineno">305</span> * ==&gt; Assigns a no-op child resize handler to elem
<span id="line306" class="lineno">306</span> */</span>
<span id="line307" class="lineno">307</span><span class="hljs-title class_">RapidContext</span>.<span class="hljs-property">Util</span>.<span class="hljs-property">resizeElements</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"><span class="hljs-comment">/* ... */</span></span>) {
<span id="line308" class="lineno">308</span>    <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(<span class="hljs-variable language_">arguments</span>).<span class="hljs-title function_">forEach</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">arg</span>) {
<span id="line309" class="lineno">309</span>        <span class="hljs-keyword">var</span> node = <span class="hljs-title class_">MochiKit</span>.<span class="hljs-property">DOM</span>.<span class="hljs-title function_">getElement</span>(arg);
<span id="line310" class="lineno">310</span>        <span class="hljs-keyword">if</span> (node &amp;&amp; node.<span class="hljs-property">nodeType</span> === <span class="hljs-number">1</span> &amp;&amp; node.<span class="hljs-property">parentNode</span> &amp;&amp; node.<span class="hljs-property">sizeConstraints</span>) {
<span id="line311" class="lineno">311</span>            <span class="hljs-keyword">var</span> ref = { <span class="hljs-attr">w</span>: node.<span class="hljs-property">parentNode</span>.<span class="hljs-property">w</span>, <span class="hljs-attr">h</span>: node.<span class="hljs-property">parentNode</span>.<span class="hljs-property">h</span> };
<span id="line312" class="lineno">312</span>            <span class="hljs-keyword">if</span> (ref.<span class="hljs-property">w</span> == <span class="hljs-literal">null</span> &amp;&amp; ref.<span class="hljs-property">h</span> == <span class="hljs-literal">null</span>) {
<span id="line313" class="lineno">313</span>                ref = <span class="hljs-title class_">MochiKit</span>.<span class="hljs-property">Style</span>.<span class="hljs-title function_">getElementDimensions</span>(node.<span class="hljs-property">parentNode</span>, <span class="hljs-literal">true</span>);
<span id="line314" class="lineno">314</span>            }
<span id="line315" class="lineno">315</span>            <span class="hljs-keyword">var</span> dim = <span class="hljs-title class_">RapidContext</span>.<span class="hljs-property">Util</span>.<span class="hljs-title function_">_evalConstraints</span>(node.<span class="hljs-property">sizeConstraints</span>, ref);
<span id="line316" class="lineno">316</span>            <span class="hljs-title class_">MochiKit</span>.<span class="hljs-property">Style</span>.<span class="hljs-title function_">setElementDimensions</span>(node, dim);
<span id="line317" class="lineno">317</span>            node.<span class="hljs-property">w</span> = dim.<span class="hljs-property">w</span>;
<span id="line318" class="lineno">318</span>            node.<span class="hljs-property">h</span> = dim.<span class="hljs-property">h</span>;
<span id="line319" class="lineno">319</span>        }
<span id="line320" class="lineno">320</span>        <span class="hljs-keyword">if</span> (node &amp;&amp; <span class="hljs-title function_">typeof</span>(node.<span class="hljs-property">resizeContent</span>) == <span class="hljs-string">&quot;function&quot;</span>) {
<span id="line321" class="lineno">321</span>            <span class="hljs-keyword">try</span> {
<span id="line322" class="lineno">322</span>                node.<span class="hljs-title function_">resizeContent</span>();
<span id="line323" class="lineno">323</span>            } <span class="hljs-keyword">catch</span> (e) {
<span id="line324" class="lineno">324</span>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;Error in resizeContent()&quot;</span>, node, e);
<span id="line325" class="lineno">325</span>            }
<span id="line326" class="lineno">326</span>        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (node &amp;&amp; node.<span class="hljs-property">childNodes</span>) {
<span id="line327" class="lineno">327</span>            <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(node.<span class="hljs-property">childNodes</span>).<span class="hljs-title function_">forEach</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">child</span>) {
<span id="line328" class="lineno">328</span>                <span class="hljs-keyword">if</span> (child.<span class="hljs-property">nodeType</span> === <span class="hljs-number">1</span>) {
<span id="line329" class="lineno">329</span>                    <span class="hljs-title class_">RapidContext</span>.<span class="hljs-property">Util</span>.<span class="hljs-title function_">resizeElements</span>(child);
<span id="line330" class="lineno">330</span>                }
<span id="line331" class="lineno">331</span>            });
<span id="line332" class="lineno">332</span>        }
<span id="line333" class="lineno">333</span>    });
<span id="line334" class="lineno">334</span>};
<span id="line335" class="lineno">335</span>
<span id="line336" class="lineno">336</span><span class="hljs-comment">/**
<span id="line337" class="lineno">337</span> * Evaluates the size constraint functions with a refeence dimension
<span id="line338" class="lineno">338</span> * object. This is an internal function used to encapsulate the
<span id="line339" class="lineno">339</span> * function calls and provide logging on errors.
<span id="line340" class="lineno">340</span> *
<span id="line341" class="lineno">341</span> * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Object</span>} sc the size constraints object
<span id="line342" class="lineno">342</span> * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Object</span>} ref the MochiKit.Style.Dimensions maximum
<span id="line343" class="lineno">343</span> *            reference values
<span id="line344" class="lineno">344</span> *
<span id="line345" class="lineno">345</span> * <span class="hljs-doctag">@return</span> {<span class="hljs-type">Object</span>} the MochiKit.Style.Dimensions with evaluated size
<span id="line346" class="lineno">346</span> *         constraint values (some may be null)
<span id="line347" class="lineno">347</span> */</span>
<span id="line348" class="lineno">348</span><span class="hljs-title class_">RapidContext</span>.<span class="hljs-property">Util</span>.<span class="hljs-property">_evalConstraints</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">sc, ref</span>) {
<span id="line349" class="lineno">349</span>    <span class="hljs-keyword">var</span> w, h;
<span id="line350" class="lineno">350</span>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">typeof</span>(sc.<span class="hljs-property">w</span>) == <span class="hljs-string">&quot;function&quot;</span>) {
<span id="line351" class="lineno">351</span>        <span class="hljs-keyword">try</span> {
<span id="line352" class="lineno">352</span>            w = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">0</span>, <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(ref.<span class="hljs-property">w</span>, sc.<span class="hljs-title function_">w</span>(ref.<span class="hljs-property">w</span>, ref.<span class="hljs-property">h</span>)));
<span id="line353" class="lineno">353</span>        } <span class="hljs-keyword">catch</span> (e) {
<span id="line354" class="lineno">354</span>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;Error evaluating width size constraint; &quot;</span> +
<span id="line355" class="lineno">355</span>                          <span class="hljs-string">&quot;w: &quot;</span> + ref.<span class="hljs-property">w</span> + <span class="hljs-string">&quot;, h: &quot;</span> + ref.<span class="hljs-property">h</span>, e);
<span id="line356" class="lineno">356</span>        }
<span id="line357" class="lineno">357</span>    }
<span id="line358" class="lineno">358</span>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">typeof</span>(sc.<span class="hljs-property">h</span>) == <span class="hljs-string">&quot;function&quot;</span>) {
<span id="line359" class="lineno">359</span>        <span class="hljs-keyword">try</span> {
<span id="line360" class="lineno">360</span>            h = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">0</span>, <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(ref.<span class="hljs-property">h</span>, sc.<span class="hljs-title function_">h</span>(ref.<span class="hljs-property">w</span>, ref.<span class="hljs-property">h</span>)));
<span id="line361" class="lineno">361</span>        } <span class="hljs-keyword">catch</span> (e) {
<span id="line362" class="lineno">362</span>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;Error evaluating height size constraint; &quot;</span> +
<span id="line363" class="lineno">363</span>                          <span class="hljs-string">&quot;w: &quot;</span> + ref.<span class="hljs-property">w</span> + <span class="hljs-string">&quot;, h: &quot;</span> + ref.<span class="hljs-property">h</span>, e);
<span id="line364" class="lineno">364</span>        }
<span id="line365" class="lineno">365</span>    }
<span id="line366" class="lineno">366</span>    <span class="hljs-keyword">if</span> (w != <span class="hljs-literal">null</span>) {
<span id="line367" class="lineno">367</span>        w = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(w);
<span id="line368" class="lineno">368</span>    }
<span id="line369" class="lineno">369</span>    <span class="hljs-keyword">if</span> (h != <span class="hljs-literal">null</span>) {
<span id="line370" class="lineno">370</span>        h = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(h);
<span id="line371" class="lineno">371</span>    }
<span id="line372" class="lineno">372</span>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MochiKit</span>.<span class="hljs-property">Style</span>.<span class="hljs-title class_">Dimensions</span>(w, h);
<span id="line373" class="lineno">373</span>};
<span id="line374" class="lineno">374</span></code></pre>
        </article>
    </section>





      </div>
    </section>

    <section class="footer center fineprint">
      <hr>
      Copyright &copy; 2007-2023 Per Cederberg. All rights reserved.
    </section>

  </body>
</html>
